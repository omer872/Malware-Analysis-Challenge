#include <windows.h>
#include <lmcons.h>
#include <wininet.h>
#include <stdio.h>


void saveSystemInfoToFile() {
    // Computer name
    char computerName[MAX_COMPUTERNAME_LENGTH + 1];
    DWORD computerNameSize = sizeof(computerName);
    if (!GetComputerNameA(computerName, &computerNameSize)) {
        perror("Error getting computer name");
        return;
    }

    // Create file name based on computer name
    char fileName[MAX_COMPUTERNAME_LENGTH + 5];  // 5 for additional characters and extension
    sprintf(fileName, "%s.txt", computerName);

    FILE* file = fopen(fileName, "w");
    if (file == NULL) {
        perror("Error opening file");
        return;
    }

    // OS version
    OSVERSIONINFO osVersion;
    osVersion.dwOSVersionInfoSize = sizeof(OSVERSIONINFO);
    if (GetVersionEx(&osVersion)) {
        fprintf(file, "OS Version: %ld\n", osVersion.dwMajorVersion);
    }

    // Memory information
    MEMORYSTATUSEX memInfo;
    memInfo.dwLength = sizeof(MEMORYSTATUSEX);
    if (GlobalMemoryStatusEx(&memInfo)) {
        fprintf(file, "Total Physical Memory: %llu bytes\n", memInfo.ullTotalPhys);
    }

    // System time and date
    SYSTEMTIME systemTime;
    GetSystemTime(&systemTime);
    fprintf(file, "System Time: %02d:%02d:%02d\n", systemTime.wHour, systemTime.wMinute, systemTime.wSecond);
    fprintf(file, "System Date: %02d/%02d/%04d\n", systemTime.wMonth, systemTime.wDay, systemTime.wYear);

    // System language
    LANGID langID = GetSystemDefaultLangID();
    fprintf(file, "System Language: %04x\n", langID);

    // Connected user
    char username[UNLEN + 1];
    DWORD usernameSize = sizeof(username);
    if (GetUserNameA(username, &usernameSize)) {
        fprintf(file, "Connected User: %s\n", username);
    }

    // Check for internet connection using InternetCheckConnection
    if (InternetCheckConnectionA("http://www.google.com", FLAG_ICC_FORCE_CONNECTION, 0)) {
        fprintf(file, "Internet Connection: Available\n");
    } else {
        fprintf(file, "Internet Connection: Not Available\n");
    }

    fclose(file);
}

int main() {
    saveSystemInfoToFile();
    return 0;
}
