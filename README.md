# Malware-Analysis-Challenge
This repo is a Malware Analysis Scenario wrote by me.
The scenario suitable for blue investigation teams, and designed to run on a Windows environment.
You can take these file, change them as you like, custom them for your investigative environment and start the challenge!
The scenario is built from three files:

## Fake_Installation.exe
This shellcode download 2 more file logo.png and Win.exe, and eventually run Win.exe

You can add the file shellcode.txt as a new section in some legit instaletion file and change
the execution flow (to be more reliable), or you can just run it as is.

I will upload the shellcode file soon!

## logo.png
Simple photo that include in the end a PE file in a shellcode format ready for injection.
Located after the string FLAG at the end of the png format.

## collect_info.exe
This executable collect basic information about the victim computer, like internet connection, language etc...
All data saved in a text file named by the victim PC name.

I used the amazing tool pe_to_shellcode by @hasherezade & @hh86 that "Converts PE so that it can be then injected just like a normal shellcode."
Here is a link to their repo: https://github.com/hasherezade/pe_to_shellcode

The output file (collect_info.shc.exe) lays inside the logo.png file mentioned earlier.

## Win.exe
The purpose of this file is to extract shellcode from the image logo.png and inject it into the notepad.exe process.
The injection commit with Thread Hijacking technique.

### some Anti-Forensics features included:
Anti-Debugging - Use NtQueryInformationProcess in order to check the isDebug flag in the process PEB structe.
                 This function defined as __attribute__((constructor)) which enable the function to run before the main.
Anti-VM - look for known procces that run on every VMWare machine. if found terminate the process.
Encoded strings - importent strings like: target process to inject and VMWare process name xored with the key "Kernel32.dll"
